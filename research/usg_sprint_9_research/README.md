## Исследование: выбор хранилища

Цель исследования - определиться с выбором СУБД в качестве хранилища данных для задания 9-ого спринтаю

В исследовании сравниваются колоночные СУБД Postgres и MongoDB и клиентские библиотеки для работы с ними на Python

Исследование проходит в 3 этапа:

### 1. Подготовка базы данных

На этом этапе создается таблица, генерируются и загружаются исходные данные. Объем исходных данных регулируется переменной `INITIAL_ROWS_COUNT`

### 2. Замеры времени отклика в однопоточном режиме

- Замер времени загрузки 100 000 строк методом, специфичным для исследуемой СУБД
- Замер времени выборки количесва лайков у конкретного фильма
- Замер времени агрегации средней пользовательской оценки одного фильма

### 3. Замеры времени отклика под нагрузкой

На этом этапе, как и на предыдущем, производятся замеры времени выборки, но при этом моделируется нагрузка на СУБД. В отдельных потоках производится запись данных в очередь со скоростью `STRESS_TESTS_WPS` строк в секунду и загрузка этих данных в базу

### 4. Замеры времени отклика при параллельном чтении

На этом этапе производятся замеры среднего времени выполнения запросов на чтение при параллельной работе нескольких клиентов

### Запуск тестового стенда

Запуск производится командой `make research_db_usg_sprint_9`. При этом поднимаются контейнеры СУБД и контейнер тестового стенда, результаты замеров выводятся в консоль, а после завершения тестирования все контейнеры останавливаются


### Результаты исследования

Результаты исследования зависят от характеристик ПК и настроек Docker, но их можно использовать в качестве сравнительных характеристик

Running speed tests
- Initial rows:     1000000
- Stress tests WPS: 10000
- Readers count:    10

DBMS:                                                 PostgreSQL
- Insert 100k rows:                                   12.258756 s
- Retrive numbers of likes per movie:                 0.023491 s     
- Retrive numbers of likes per movie under load:      0.019077 s
- Retrive numbers of likes per movie in parallel:     0.095220 s
- Retrieve average score for movie:                   0.019257 s
- Retrieve average score for movie under load:        0.018860 s
- Retrieve average score for movie in parallel:       0.106141 s


DBMS:                                                 MongoDB
- Insert 100k rows:                                   24.486458 s
- Retrive numbers of likes per movie:                 0.001004 s     
- Retrive numbers of likes per movie under load:      0.006633 s
- Retrive numbers of likes per movie in parallel:     0.041395 s
- Retrieve average score for movie:                   0.001753 s
- Retrieve average score for movie under load:        0.001889 s
- Retrieve average score for movie in parallel:       0.004285 s

Очевидным выбором среди исследуемых СУБД является MongoDB c так как критическим параметром является как раз скорость чтения.
